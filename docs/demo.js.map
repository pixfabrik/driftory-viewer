{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/@dan503/load-js/index.js","src/demo/demo.ts","src/library/driftory.ts"],"names":[],"mappings":"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","file":"demo.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar alreadyCalledScripts = [];\r\nvar allScripts = {};\r\nvar defaultScript = { hasLoaded: false, callbacks: [] };\r\nvar addCallback = function (src, callback) {\r\n    var script = allScripts[src];\r\n    if (!script)\r\n        return;\r\n    if (script.hasLoaded) {\r\n        // If the script has already been previously loaded, just run the callback immediately\r\n        callback();\r\n    }\r\n    else {\r\n        if (script.callbacks.length > 0) {\r\n            script.callbacks.push(callback);\r\n        }\r\n        else {\r\n            script.callbacks = [callback];\r\n        }\r\n    }\r\n};\r\nfunction loadJS(src, callback) {\r\n    var script = allScripts[src] || defaultScript;\r\n    allScripts[src] = script;\r\n    if (alreadyCalledScripts.indexOf(src) < 0) {\r\n        alreadyCalledScripts.push(src);\r\n        var $scriptElem = document.createElement('script');\r\n        $scriptElem.setAttribute('class', 'load-js-script');\r\n        $scriptElem.src = src;\r\n        $scriptElem.onload = function () {\r\n            addCallback(src, callback);\r\n            var updatedScript = allScripts[src];\r\n            if (updatedScript) {\r\n                updatedScript.hasLoaded = true;\r\n            }\r\n            for (var thisSource in allScripts) {\r\n                var thisScript = allScripts[thisSource] || defaultScript;\r\n                thisScript.callbacks.forEach(function (cb) { return cb(); });\r\n            }\r\n        };\r\n        document.head.appendChild($scriptElem);\r\n    }\r\n    else {\r\n        addCallback(src, callback);\r\n    }\r\n}\r\nexports.default = loadJS;\r\n","import Driftory from '../library/driftory';\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  // We need to cast this to HTMLDivElement because that's what Driftory needs.\n  const container = document.querySelector('.driftory-viewer-container') as HTMLDivElement | null;\n\n  const startButton = document.querySelector('.start-button');\n  const endButton = document.querySelector('.end-button');\n  const previousButton = document.querySelector('.previous-button');\n  const nextButton = document.querySelector('.next-button');\n  const hideButton = document.querySelector('.hide-button');\n  const navButton = document.querySelector('.nav-button');\n  const frameInfo = document.querySelector('.frame-info');\n\n  if (!container) {\n    console.error('Cannot find viewer container');\n    return;\n  }\n\n  const driftory = new Driftory({\n    container,\n    onComicLoad: () => {\n      console.log('loaded!');\n    },\n    onFrameChange: ({ frameIndex = 0, isLastFrame }) => {\n      if (frameInfo) {\n        let text = `Frame ${frameIndex + 1}`;\n        if (isLastFrame) {\n          text += ' (last frame!)';\n        }\n\n        frameInfo.textContent = text;\n      }\n    },\n    onNoNext: () => {\n      console.log('User trying to go past end');\n    },\n    onNoPrevious: () => {\n      console.log('User trying to go before beginning');\n    }\n  });\n\n  startButton?.addEventListener('click', () => {\n    driftory.goToFrame(0);\n  });\n\n  endButton?.addEventListener('click', () => {\n    driftory.goToFrame(driftory.getFrameCount() - 1);\n  });\n\n  previousButton?.addEventListener('click', () => {\n    driftory.goToPreviousFrame();\n  });\n\n  nextButton?.addEventListener('click', () => {\n    driftory.goToNextFrame();\n  });\n\n  hideButton?.addEventListener('click', () => {\n    container.classList.toggle('hide');\n  });\n\n  navButton?.addEventListener('click', () => {\n    const flag = !driftory.getNavEnabled();\n    driftory.setNavEnabled(flag);\n    navButton.textContent = flag ? 'disable nav' : 'enable nav';\n  });\n\n  const comicName = 'comic.json';\n  // const comicName = 'comic-no-frames.json';\n  // const comicName = 'comic-hide-until-frame.json';\n  fetch(comicName)\n    .then((response) => {\n      if (!response.ok) {\n        console.error(response);\n        throw new Error('Failed to load ' + comicName);\n      }\n\n      return response.json();\n    })\n    .then((json) => {\n      // console.log(json);\n      driftory.openComic(json);\n    })\n    .catch((error) => console.error(error));\n});\n","import loadJs from '@dan503/load-js';\nimport { Comic } from './Comic.types';\nimport { OpenSeadragonType, ViewerType } from './openseadragon.types';\n\ninterface OsdRequest {\n  resolve: (value?: unknown) => void;\n  reject: (reason?: any) => void;\n}\n\nlet OpenSeadragon: OpenSeadragonType | undefined;\nlet osdRequest: OsdRequest | undefined;\n\ndeclare global {\n  interface Window {\n    OpenSeadragon: OpenSeadragonType;\n  }\n}\n\nconst osdPromise = new Promise((resolve, reject) => {\n  osdRequest = { resolve, reject };\n});\n\ninterface ImageItem {\n  hideUntilFrame?: number;\n  tiledImage?: OpenSeadragon.TiledImage;\n}\n\ntype Frame = OpenSeadragon.Rect;\ntype Container = HTMLElement;\ntype OnFrameChange = (params: { frameIndex: number; isLastFrame: boolean }) => void;\ntype OnComicLoad = (params: {}) => void;\ntype OnNoNext = (params: {}) => void;\ntype OnNoPrevious = (params: {}) => void;\n\nexport interface DriftoryArguments {\n  /** The HTML DOM element that the Driftory Comic will be rendered in.  */\n  container: Container;\n  /**\n   * This library has a dependency on the [OpenSeadragon](https://openseadragon.github.io/) library.\n   *\n   * By default, OpenSeadragon will be loaded from [the JS Deliver CDN](https://cdn.jsdelivr.net/npm/openseadragon@2.4/build/openseadragon/openseadragon.min.js)\n   * while initializing.\n   *\n   * To prevent this, you can use this parameter to provide your own instance of OpenSeaDragon instead.\n   *  */\n  OpenSeadragon?: OpenSeadragonType;\n  /** Called whenever driftory navigates to a new frame, whether via clicking, dragging, keys, or API. */\n  onFrameChange?: OnFrameChange;\n  /** Called when the comic has finished initializing. */\n  onComicLoad?: OnComicLoad;\n  /** Called when the user tries to navigate to the next frame in the sequence\n   *  but there are no frames left to navigate to. */\n  onNoNext?: OnNoNext;\n  /** Called when the user tries to navigate to the previous frame in the sequence\n   *  but there are no frames left to navigate to. */\n  onNoPrevious?: OnNoPrevious;\n}\n\nexport default class Driftory {\n  container: Container;\n  onFrameChange: OnFrameChange;\n  onComicLoad: OnComicLoad;\n  onNoNext: OnNoNext;\n  onNoPrevious: OnNoPrevious;\n  imageItems: Array<ImageItem> = [];\n  frames: Array<Frame> = [];\n  frameIndex: number = -1;\n  frameIndexHint: number = -1;\n  lastScrollTime: number = 0;\n  scrollDelay: number = 2000;\n  viewer?: ViewerType;\n  navEnabled: boolean = true;\n\n  // ----------\n  constructor(args: DriftoryArguments) {\n    this.container = args.container;\n    this.onFrameChange = args.onFrameChange || function () {};\n    this.onComicLoad = args.onComicLoad || function () {};\n    this.onNoNext = args.onNoNext || function () {};\n    this.onNoPrevious = args.onNoPrevious || function () {};\n\n    if (args.OpenSeadragon) {\n      OpenSeadragon = args.OpenSeadragon;\n      this._initialize(args);\n      osdRequest?.resolve();\n    } else {\n      // Note: loadJs only loads the file once, even if called multiple times, and always makes sure\n      // all of the callbacks are called.\n      loadJs(\n        'https://cdn.jsdelivr.net/npm/openseadragon@2.4/build/openseadragon/openseadragon.min.js',\n        () => {\n          OpenSeadragon = window.OpenSeadragon;\n          this._initialize(args);\n          osdRequest?.resolve();\n        }\n      );\n    }\n  }\n\n  // ----------\n  _initialize({ container }: DriftoryArguments) {\n    this.viewer =\n      OpenSeadragon &&\n      OpenSeadragon({\n        element: container,\n        showNavigationControl: false,\n        maxZoomPixelRatio: 10,\n        gestureSettingsMouse: {\n          clickToZoom: false\n        }\n      });\n\n    if (this.viewer) {\n      this.viewer.addHandler('canvas-click', (event) => {\n        if (!event || !event.quick || !event.position || !this.viewer || !this.navEnabled) {\n          return;\n        }\n\n        const point = this.viewer.viewport.pointFromPixel(event.position);\n        let foundIndex = this._getHitFrame(point);\n        if (foundIndex === -1) {\n          const realFrameIndex = this._figureFrameIndex(true);\n          if (realFrameIndex === -1 && this.frameIndex !== undefined) {\n            this.goToFrame(this.frameIndex);\n          } else {\n            this.goToNextFrame();\n          }\n        } else if (foundIndex === this.frameIndex) {\n          this.goToNextFrame();\n        } else {\n          this.goToFrame(foundIndex);\n        }\n      });\n\n      const originalScrollHandler = this.viewer.innerTracker.scrollHandler;\n      this.viewer.innerTracker.scrollHandler = (event) => {\n        if (!this.navEnabled) {\n          // Returning false stops the browser from scrolling itself.\n          return false;\n        }\n\n        if (\n          event.originalEvent.ctrlKey ||\n          event.originalEvent.altKey ||\n          event.originalEvent.metaKey\n        ) {\n          return originalScrollHandler.call(this.viewer?.innerTracker, event);\n        }\n\n        const now = Date.now();\n        // console.log(event.scroll, now, now - this.lastScrollTime);\n        if (now - this.lastScrollTime < this.scrollDelay) {\n          // Returning false stops the browser from scrolling itself.\n          return false;\n        }\n\n        this.lastScrollTime = now;\n        if (event.scroll < 0) {\n          this.goToNextFrame();\n        } else {\n          this.goToPreviousFrame();\n        }\n\n        // Returning false stops the browser from scrolling itself.\n        return false;\n      };\n\n      window.addEventListener('keydown', (event) => {\n        if (event.altKey || event.shiftKey || event.ctrlKey || event.metaKey || !this.navEnabled) {\n          return;\n        }\n\n        if (event.key === 'ArrowRight' || event.key === 'ArrowDown' || event.key === ' ') {\n          this.goToNextFrame();\n        } else if (event.key === 'ArrowLeft' || event.key === 'ArrowUp') {\n          this.goToPreviousFrame();\n        } else {\n          return;\n        }\n\n        event.preventDefault();\n        event.stopPropagation();\n      });\n    }\n  }\n\n  /** Render the comic on screen */\n  openComic(unsafeComic: Comic | string) {\n    if (this.frames.length || this.imageItems.length) {\n      console.error(\n        'Currently the Driftory viewer is not set up to load a second comic after the first.'\n      );\n\n      return;\n    }\n\n    const { comic } =\n      typeof unsafeComic === 'string' ? (JSON.parse(unsafeComic) as Comic) : unsafeComic;\n\n    osdPromise.then(() => {\n      this.container.style.backgroundColor = comic.body.backgroundColor;\n\n      if (this.viewer) {\n        if (comic.body.frames) {\n          this.frames = comic.body.frames.map((frame) => {\n            return new OpenSeadragon!.Rect(\n              frame.x - frame.width / 2,\n              frame.y - frame.height / 2,\n              frame.width,\n              frame.height\n            );\n          });\n        } else {\n          this.frames = comic.body.items.map((item) => {\n            return new OpenSeadragon!.Rect(\n              item.x - item.width / 2,\n              item.y - item.height / 2,\n              item.width,\n              item.height\n            );\n          });\n        }\n\n        comic.body.items.forEach((item, i) => {\n          const imageItem: ImageItem = {\n            hideUntilFrame: item.hideUntilFrame\n          };\n\n          this.imageItems.push(imageItem);\n\n          this.viewer?.addTiledImage({\n            preload: true,\n            x: item.x - item.width / 2,\n            y: item.y - item.height / 2,\n            width: item.width,\n            success: (event: any) => {\n              imageItem.tiledImage = event.item as OpenSeadragon.TiledImage;\n              this._updateImageVisibility();\n\n              if (i === 0) {\n                this._startComic();\n              }\n            },\n            tileSource: {\n              type: 'legacy-image-pyramid',\n              levels: [\n                {\n                  url: item.url,\n                  width: item.width,\n                  height: item.height\n                }\n              ]\n            }\n          });\n        });\n      }\n    });\n  }\n\n  // ----------\n  _startComic() {\n    if (this.viewer) {\n      const frameHandler = () => {\n        const frameIndex = this._figureFrameIndex(false);\n        if (frameIndex !== -1 && frameIndex !== this.frameIndex) {\n          this.frameIndex = frameIndex;\n          this._updateImageVisibility();\n\n          if (this.onFrameChange) {\n            this.onFrameChange({\n              frameIndex,\n              isLastFrame: frameIndex === this.getFrameCount() - 1\n            });\n          }\n        }\n      };\n\n      this.viewer.addHandler('zoom', frameHandler);\n      this.viewer.addHandler('pan', frameHandler);\n    }\n\n    this.goToFrame(0);\n\n    if (this.onComicLoad) {\n      this.onComicLoad({});\n    }\n  }\n\n  // ----------\n  _updateImageVisibility() {\n    this.imageItems.forEach((imageItem) => {\n      if (imageItem.hideUntilFrame !== undefined) {\n        imageItem.tiledImage?.setOpacity(this.frameIndex < imageItem.hideUntilFrame ? 0 : 1);\n      }\n    });\n  }\n\n  /** Determine if the frame navigation controls are currently able to be used to navigate */\n  getNavEnabled() {\n    return this.navEnabled;\n  }\n\n  /** Enable / Disable frame navigation controls */\n  setNavEnabled(flag: boolean) {\n    this.navEnabled = flag;\n    this.viewer?.setMouseNavEnabled(flag);\n  }\n\n  /** Navigate to a specific frame via its index number */\n  goToFrame(index: number) {\n    if (this.getFrameIndex() !== index) {\n      var frame = this.frames[index];\n      var bufferFactor = 0.2;\n      if (frame) {\n        this.frameIndexHint = index;\n\n        var box = frame.clone();\n\n        box.width *= 1 + bufferFactor;\n        box.height *= 1 + bufferFactor;\n        box.x -= frame.width * bufferFactor * 0.5;\n        box.y -= frame.height * bufferFactor * 0.5;\n\n        this.viewer?.viewport.fitBounds(box);\n      }\n    }\n  }\n\n  /** Get the currently active frame index. This will be whatever frame is in the middle of the\n  screen. If there is no frame in the middle, it'll be whatever frame the user last had there. */\n  getFrameIndex() {\n    return this.frameIndex;\n  }\n\n  // ----------\n  _figureFrameIndex(current: boolean) {\n    let bestIndex = -1;\n    let bestDistance = Infinity;\n    if (this.viewer) {\n      const viewportBounds = this.viewer.viewport.getBounds(current);\n      const viewportCenter = viewportBounds.getCenter();\n\n      for (let i = 0; i < this.frames.length; i++) {\n        const frame = this.frames[i];\n        if (frame.containsPoint(viewportCenter)) {\n          if (this.frameIndexHint === i) {\n            bestIndex = i;\n            break;\n          }\n\n          const distance = viewportCenter.squaredDistanceTo(frame.getCenter());\n          if (distance < bestDistance) {\n            bestDistance = distance;\n            bestIndex = i;\n          }\n        }\n      }\n    }\n\n    return bestIndex;\n  }\n\n  // ----------\n  _getHitFrame(point: OpenSeadragon.Point) {\n    let bestIndex = -1;\n\n    if (this.viewer) {\n      for (let i = 0; i < this.frames.length; i++) {\n        const frame = this.frames[i];\n        if (frame.containsPoint(point)) {\n          if (this.frameIndex === i) {\n            bestIndex = i;\n            break;\n          }\n\n          if (bestIndex === -1) {\n            bestIndex = i;\n          }\n        }\n      }\n    }\n\n    return bestIndex;\n  }\n\n  /** Return the total number of frames found in the comic sequence */\n  getFrameCount() {\n    return this.frames.length;\n  }\n\n  /** Navigate to the next frame in the sequence */\n  goToNextFrame() {\n    let index = this.getFrameIndex();\n    if (index < this.frames.length - 1) {\n      this.goToFrame(index + 1);\n    } else {\n      this.onNoNext({});\n    }\n  }\n\n  /** Navigate to the previous frame in the sequence */\n  goToPreviousFrame() {\n    let index = this.getFrameIndex();\n    if (index > 0) {\n      this.goToFrame(index - 1);\n    } else {\n      this.onNoPrevious({});\n    }\n  }\n}\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvQGRhbjUwMy9sb2FkLWpzL2luZGV4LmpzIiwic3JjL2RlbW8vZGVtby50cyIsInNyYy9saWJyYXJ5L2RyaWZ0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNoREEsaUVBQTJDO0FBRTNDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsRUFBRTtJQUM1Qyw2RUFBNkU7SUFDN0UsSUFBTSxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyw0QkFBNEIsQ0FBMEIsQ0FBQztJQUVoRyxJQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0lBQzVELElBQU0sU0FBUyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLENBQUM7SUFDeEQsSUFBTSxjQUFjLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0lBQ2xFLElBQU0sVUFBVSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDMUQsSUFBTSxVQUFVLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUMxRCxJQUFNLFNBQVMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3hELElB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LEVBQUUsQ0FBQyxDQUFDO1NBQ25CO0lBQ0gsQ0FBQztJQUVELHFEQUFxRDtJQUNyRCxvQ0FBaUIsR0FBakI7UUFDRSxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDakMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxFQUFFO1lBQ2IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDM0I7YUFBTTtZQUNMLElBQUksQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDdkI7SUFDSCxDQUFDO0lBQ0gsZUFBQztBQUFELENBL1ZBLEFBK1ZDLElBQUEiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG52YXIgYWxyZWFkeUNhbGxlZFNjcmlwdHMgPSBbXTtcclxudmFyIGFsbFNjcmlwdHMgPSB7fTtcclxudmFyIGRlZmF1bHRTY3JpcHQgPSB7IGhhc0xvYWRlZDogZmFsc2UsIGNhbGxiYWNrczogW10gfTtcclxudmFyIGFkZENhbGxiYWNrID0gZnVuY3Rpb24gKHNyYywgY2FsbGJhY2spIHtcclxuICAgIHZhciBzY3JpcHQgPSBhbGxTY3JpcHRzW3NyY107XHJcbiAgICBpZiAoIXNjcmlwdClcclxuICAgICAgICByZXR1cm47XHJcbiAgICBpZiAoc2NyaXB0Lmhhc0xvYWRlZCkge1xyXG4gICAgICAgIC8vIElmIHRoZSBzY3JpcHQgaGFzIGFscmVhZHkgYmVlbiBwcmV2aW91c2x5IGxvYWRlZCwganVzdCBydW4gdGhlIGNhbGxiYWNrIGltbWVkaWF0ZWx5XHJcbiAgICAgICAgY2FsbGJhY2soKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGlmIChzY3JpcHQuY2FsbGJhY2tzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgc2NyaXB0LmNhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHNjcmlwdC5jYWxsYmFja3MgPSBbY2FsbGJhY2tdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuZnVuY3Rpb24gbG9hZEpTKHNyYywgY2FsbGJhY2spIHtcclxuICAgIHZhciBzY3JpcHQgPSBhbGxTY3JpcHRzW3NyY10gfHwgZGVmYXVsdFNjcmlwdDtcclxuICAgIGFsbFNjcmlwdHNbc3JjXSA9IHNjcmlwdDtcclxuICAgIGlmIChhbHJlYWR5Q2FsbGVkU2NyaXB0cy5pbmRleE9mKHNyYykgPCAwKSB7XHJcbiAgICAgICAgYWxyZWFkeUNhbGxlZFNjcmlwdHMucHVzaChzcmMpO1xyXG4gICAgICAgIHZhciAkc2NyaXB0RWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xyXG4gICAgICAgICRzY3JpcHRFbGVtLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnbG9hZC1qcy1zY3JpcHQnKTtcclxuICAgICAgICAkc2NyaXB0RWxlbS5zcmMgPSBzcmM7XHJcbiAgICAgICAgJHNjcmlwdEVsZW0ub25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBhZGRDYWxsYmFjayhzcmMsIGNhbGxiYWNrKTtcclxuICAgICAgICAgICAgdmFyIHVwZGF0ZWRTY3JpcHQgPSBhbGxTY3JpcHRzW3NyY107XHJcbiAgICAgICAgICAgIGlmICh1cGRhdGVkU2NyaXB0KSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVkU2NyaXB0Lmhhc0xvYWRlZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yICh2YXIgdGhpc1NvdXJjZSBpbiBhbGxTY3JpcHRzKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGhpc1NjcmlwdCA9IGFsbFNjcmlwdHNbdGhpc1NvdXJjZV0gfHwgZGVmYXVsdFNjcmlwdDtcclxuICAgICAgICAgICAgICAgIHRoaXNTY3JpcHQuY2FsbGJhY2tzLmZvckVhY2goZnVuY3Rpb24gKGNiKSB7IHJldHVybiBjYigpOyB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCgkc2NyaXB0RWxlbSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBhZGRDYWxsYmFjayhzcmMsIGNhbGxiYWNrKTtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLmRlZmF1bHQgPSBsb2FkSlM7XHJcbiIsImltcG9ydCBEcmlmdG9yeSBmcm9tICcuLi9saWJyYXJ5L2RyaWZ0b3J5JztcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcbiAgLy8gV2UgbmVlZCB0byBjYXN0IHRoaXMgdG8gSFRNTERpdkVsZW1lbnQgYmVjYXVzZSB0aGF0J3Mgd2hhdCBEcmlmdG9yeSBuZWVkcy5cbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmRyaWZ0b3J5LXZpZXdlci1jb250YWluZXInKSBhcyBIVE1MRGl2RWxlbWVudCB8IG51bGw7XG5cbiAgY29uc3Qgc3RhcnRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc3RhcnQtYnV0dG9uJyk7XG4gIGNvbnN0IGVuZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lbmQtYnV0dG9uJyk7XG4gIGNvbnN0IHByZXZpb3VzQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByZXZpb3VzLWJ1dHRvbicpO1xuICBjb25zdCBuZXh0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5leHQtYnV0dG9uJyk7XG4gIGNvbnN0IGhpZGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGlkZS1idXR0b24nKTtcbiAgY29uc3QgbmF2QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5hdi1idXR0b24nKTtcbiAgY29uc3QgZnJhbWVJbmZvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmZyYW1lLWluZm8nKTtcblxuICBpZiAoIWNvbnRhaW5lcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Nhbm5vdCBmaW5kIHZpZXdlciBjb250YWluZXInKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBkcmlmdG9yeSA9IG5ldyBEcmlmdG9yeSh7XG4gICAgY29udGFpbmVyLFxuICAgIG9uQ29taWNMb2FkOiAoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnbG9hZGVkIScpO1xuICAgIH0sXG4gICAgb25GcmFtZUNoYW5nZTogKHsgZnJhbWVJbmRleCA9IDAsIGlzTGFzdEZyYW1lIH0pID0+IHtcbiAgICAgIGlmIChmcmFtZUluZm8pIHtcbiAgICAgICAgbGV0IHRleHQgPSBgRnJhbWUgJHtmcmFtZUluZGV4ICsgMX1gO1xuICAgICAgICBpZiAoaXNMYXN0RnJhbWUpIHtcbiAgICAgICAgICB0ZXh0ICs9ICcgKGxhc3QgZnJhbWUhKSc7XG4gICAgICAgIH1cblxuICAgICAgICBmcmFtZUluZm8udGV4dENvbnRlbnQgPSB0ZXh0O1xuICAgICAgfVxuICAgIH0sXG4gICAgb25Ob05leHQ6ICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdVc2VyIHRyeWluZyB0byBnbyBwYXN0IGVuZCcpO1xuICAgIH0sXG4gICAgb25Ob1ByZXZpb3VzOiAoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnVXNlciB0cnlpbmcgdG8gZ28gYmVmb3JlIGJlZ2lubmluZycpO1xuICAgIH1cbiAgfSk7XG5cbiAgc3RhcnRCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGRyaWZ0b3J5LmdvVG9GcmFtZSgwKTtcbiAgfSk7XG5cbiAgZW5kQnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBkcmlmdG9yeS5nb1RvRnJhbWUoZHJpZnRvcnkuZ2V0RnJhbWVDb3VudCgpIC0gMSk7XG4gIH0pO1xuXG4gIHByZXZpb3VzQnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBkcmlmdG9yeS5nb1RvUHJldmlvdXNGcmFtZSgpO1xuICB9KTtcblxuICBuZXh0QnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBkcmlmdG9yeS5nb1RvTmV4dEZyYW1lKCk7XG4gIH0pO1xuXG4gIGhpZGVCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgIGNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoaWRlJyk7XG4gIH0pO1xuXG4gIG5hdkJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgY29uc3QgZmxhZyA9ICFkcmlmdG9yeS5nZXROYXZFbmFibGVkKCk7XG4gICAgZHJpZnRvcnkuc2V0TmF2RW5hYmxlZChmbGFnKTtcbiAgICBuYXZCdXR0b24udGV4dENvbnRlbnQgPSBmbGFnID8gJ2Rpc2FibGUgbmF2JyA6ICdlbmFibGUgbmF2JztcbiAgfSk7XG5cbiAgY29uc3QgY29taWNOYW1lID0gJ2NvbWljLmpzb24nO1xuICAvLyBjb25zdCBjb21pY05hbWUgPSAnY29taWMtbm8tZnJhbWVzLmpzb24nO1xuICAvLyBjb25zdCBjb21pY05hbWUgPSAnY29taWMtaGlkZS11bnRpbC1mcmFtZS5qc29uJztcbiAgZmV0Y2goY29taWNOYW1lKVxuICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICBjb25zb2xlLmVycm9yKHJlc3BvbnNlKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gbG9hZCAnICsgY29taWNOYW1lKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbiAgICB9KVxuICAgIC50aGVuKChqc29uKSA9PiB7XG4gICAgICAvLyBjb25zb2xlLmxvZyhqc29uKTtcbiAgICAgIGRyaWZ0b3J5Lm9wZW5Db21pYyhqc29uKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyb3IpID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKTtcbn0pO1xuIiwiaW1wb3J0IGxvYWRKcyBmcm9tICdAZGFuNTAzL2xvYWQtanMnO1xuaW1wb3J0IHsgQ29taWMgfSBmcm9tICcuL0NvbWljLnR5cGVzJztcbmltcG9ydCB7IE9wZW5TZWFkcmFnb25UeXBlLCBWaWV3ZXJUeXBlIH0gZnJvbSAnLi9vcGVuc2VhZHJhZ29uLnR5cGVzJztcblxuaW50ZXJmYWNlIE9zZFJlcXVlc3Qge1xuICByZXNvbHZlOiAodmFsdWU/OiB1bmtub3duKSA9PiB2b2lkO1xuICByZWplY3Q6IChyZWFzb24/OiBhbnkpID0+IHZvaWQ7XG59XG5cbmxldCBPcGVuU2VhZHJhZ29uOiBPcGVuU2VhZHJhZ29uVHlwZSB8IHVuZGVmaW5lZDtcbmxldCBvc2RSZXF1ZXN0OiBPc2RSZXF1ZXN0IHwgdW5kZWZpbmVkO1xuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIGludGVyZmFjZSBXaW5kb3cge1xuICAgIE9wZW5TZWFkcmFnb246IE9wZW5TZWFkcmFnb25UeXBlO1xuICB9XG59XG5cbmNvbnN0IG9zZFByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gIG9zZFJlcXVlc3QgPSB7IHJlc29sdmUsIHJlamVjdCB9O1xufSk7XG5cbmludGVyZmFjZSBJbWFnZUl0ZW0ge1xuICBoaWRlVW50aWxGcmFtZT86IG51bWJlcjtcbiAgdGlsZWRJbWFnZT86IE9wZW5TZWFkcmFnb24uVGlsZWRJbWFnZTtcbn1cblxudHlwZSBGcmFtZSA9IE9wZW5TZWFkcmFnb24uUmVjdDtcbnR5cGUgQ29udGFpbmVyID0gSFRNTEVsZW1lbnQ7XG50eXBlIE9uRnJhbWVDaGFuZ2UgPSAocGFyYW1zOiB7IGZyYW1lSW5kZXg6IG51bWJlcjsgaXNMYXN0RnJhbWU6IGJvb2xlYW4gfSkgPT4gdm9pZDtcbnR5cGUgT25Db21pY0xvYWQgPSAocGFyYW1zOiB7fSkgPT4gdm9pZDtcbnR5cGUgT25Ob05leHQgPSAocGFyYW1zOiB7fSkgPT4gdm9pZDtcbnR5cGUgT25Ob1ByZXZpb3VzID0gKHBhcmFtczoge30pID0+IHZvaWQ7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRHJpZnRvcnlBcmd1bWVudHMge1xuICAvKiogVGhlIEhUTUwgRE9NIGVsZW1lbnQgdGhhdCB0aGUgRHJpZnRvcnkgQ29taWMgd2lsbCBiZSByZW5kZXJlZCBpbi4gICovXG4gIGNvbnRhaW5lcjogQ29udGFpbmVyO1xuICAvKipcbiAgICogVGhpcyBsaWJyYXJ5IGhhcyBhIGRlcGVuZGVuY3kgb24gdGhlIFtPcGVuU2VhZHJhZ29uXShodHRwczovL29wZW5zZWFkcmFnb24uZ2l0aHViLmlvLykgbGlicmFyeS5cbiAgICpcbiAgICogQnkgZGVmYXVsdCwgT3BlblNlYWRyYWdvbiB3aWxsIGJlIGxvYWRlZCBmcm9tIFt0aGUgSlMgRGVsaXZlciBDRE5dKGh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vb3BlbnNlYWRyYWdvbkAyLjQvYnVpbGQvb3BlbnNlYWRyYWdvbi9vcGVuc2VhZHJhZ29uLm1pbi5qcylcbiAgICogd2hpbGUgaW5pdGlhbGl6aW5nLlxuICAgKlxuICAgKiBUbyBwcmV2ZW50IHRoaXMsIHlvdSBjYW4gdXNlIHRoaXMgcGFyYW1ldGVyIHRvIHByb3ZpZGUgeW91ciBvd24gaW5zdGFuY2Ugb2YgT3BlblNlYURyYWdvbiBpbnN0ZWFkLlxuICAgKiAgKi9cbiAgT3BlblNlYWRyYWdvbj86IE9wZW5TZWFkcmFnb25UeXBlO1xuICAvKiogQ2FsbGVkIHdoZW5ldmVyIGRyaWZ0b3J5IG5hdmlnYXRlcyB0byBhIG5ldyBmcmFtZSwgd2hldGhlciB2aWEgY2xpY2tpbmcsIGRyYWdnaW5nLCBrZXlzLCBvciBBUEkuICovXG4gIG9uRnJhbWVDaGFuZ2U/OiBPbkZyYW1lQ2hhbmdlO1xuICAvKiogQ2FsbGVkIHdoZW4gdGhlIGNvbWljIGhhcyBmaW5pc2hlZCBpbml0aWFsaXppbmcuICovXG4gIG9uQ29taWNMb2FkPzogT25Db21pY0xvYWQ7XG4gIC8qKiBDYWxsZWQgd2hlbiB0aGUgdXNlciB0cmllcyB0byBuYXZpZ2F0ZSB0byB0aGUgbmV4dCBmcmFtZSBpbiB0aGUgc2VxdWVuY2VcbiAgICogIGJ1dCB0aGVyZSBhcmUgbm8gZnJhbWVzIGxlZnQgdG8gbmF2aWdhdGUgdG8uICovXG4gIG9uTm9OZXh0PzogT25Ob05leHQ7XG4gIC8qKiBDYWxsZWQgd2hlbiB0aGUgdXNlciB0cmllcyB0byBuYXZpZ2F0ZSB0byB0aGUgcHJldmlvdXMgZnJhbWUgaW4gdGhlIHNlcXVlbmNlXG4gICAqICBidXQgdGhlcmUgYXJlIG5vIGZyYW1lcyBsZWZ0IHRvIG5hdmlnYXRlIHRvLiAqL1xuICBvbk5vUHJldmlvdXM/OiBPbk5vUHJldmlvdXM7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIERyaWZ0b3J5IHtcbiAgY29udGFpbmVyOiBDb250YWluZXI7XG4gIG9uRnJhbWVDaGFuZ2U6IE9uRnJhbWVDaGFuZ2U7XG4gIG9uQ29taWNMb2FkOiBPbkNvbWljTG9hZDtcbiAgb25Ob05leHQ6IE9uTm9OZXh0O1xuICBvbk5vUHJldmlvdXM6IE9uTm9QcmV2aW91cztcbiAgaW1hZ2VJdGVtczogQXJyYXk8SW1hZ2VJdGVtPiA9IFtdO1xuICBmcmFtZXM6IEFycmF5PEZyYW1lPiA9IFtdO1xuICBmcmFtZUluZGV4OiBudW1iZXIgPSAtMTtcbiAgZnJhbWVJbmRleEhpbnQ6IG51bWJlciA9IC0xO1xuICBsYXN0U2Nyb2xsVGltZTogbnVtYmVyID0gMDtcbiAgc2Nyb2xsRGVsYXk6IG51bWJlciA9IDIwMDA7XG4gIHZpZXdlcj86IFZpZXdlclR5cGU7XG4gIG5hdkVuYWJsZWQ6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIC8vIC0tLS0tLS0tLS1cbiAgY29uc3RydWN0b3IoYXJnczogRHJpZnRvcnlBcmd1bWVudHMpIHtcbiAgICB0aGlzLmNvbnRhaW5lciA9IGFyZ3MuY29udGFpbmVyO1xuICAgIHRoaXMub25GcmFtZUNoYW5nZSA9IGFyZ3Mub25GcmFtZUNoYW5nZSB8fCBmdW5jdGlvbiAoKSB7fTtcbiAgICB0aGlzLm9uQ29taWNMb2FkID0gYXJncy5vbkNvbWljTG9hZCB8fCBmdW5jdGlvbiAoKSB7fTtcbiAgICB0aGlzLm9uTm9OZXh0ID0gYXJncy5vbk5vTmV4dCB8fCBmdW5jdGlvbiAoKSB7fTtcbiAgICB0aGlzLm9uTm9QcmV2aW91cyA9IGFyZ3Mub25Ob1ByZXZpb3VzIHx8IGZ1bmN0aW9uICgpIHt9O1xuXG4gICAgaWYgKGFyZ3MuT3BlblNlYWRyYWdvbikge1xuICAgICAgT3BlblNlYWRyYWdvbiA9IGFyZ3MuT3BlblNlYWRyYWdvbjtcbiAgICAgIHRoaXMuX2luaXRpYWxpemUoYXJncyk7XG4gICAgICBvc2RSZXF1ZXN0Py5yZXNvbHZlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE5vdGU6IGxvYWRKcyBvbmx5IGxvYWRzIHRoZSBmaWxlIG9uY2UsIGV2ZW4gaWYgY2FsbGVkIG11bHRpcGxlIHRpbWVzLCBhbmQgYWx3YXlzIG1ha2VzIHN1cmVcbiAgICAgIC8vIGFsbCBvZiB0aGUgY2FsbGJhY2tzIGFyZSBjYWxsZWQuXG4gICAgICBsb2FkSnMoXG4gICAgICAgICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL29wZW5zZWFkcmFnb25AMi40L2J1aWxkL29wZW5zZWFkcmFnb24vb3BlbnNlYWRyYWdvbi5taW4uanMnLFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgT3BlblNlYWRyYWdvbiA9IHdpbmRvdy5PcGVuU2VhZHJhZ29uO1xuICAgICAgICAgIHRoaXMuX2luaXRpYWxpemUoYXJncyk7XG4gICAgICAgICAgb3NkUmVxdWVzdD8ucmVzb2x2ZSgpO1xuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS1cbiAgX2luaXRpYWxpemUoeyBjb250YWluZXIgfTogRHJpZnRvcnlBcmd1bWVudHMpIHtcbiAgICB0aGlzLnZpZXdlciA9XG4gICAgICBPcGVuU2VhZHJhZ29uICYmXG4gICAgICBPcGVuU2VhZHJhZ29uKHtcbiAgICAgICAgZWxlbWVudDogY29udGFpbmVyLFxuICAgICAgICBzaG93TmF2aWdhdGlvbkNvbnRyb2w6IGZhbHNlLFxuICAgICAgICBtYXhab29tUGl4ZWxSYXRpbzogMTAsXG4gICAgICAgIGdlc3R1cmVTZXR0aW5nc01vdXNlOiB7XG4gICAgICAgICAgY2xpY2tUb1pvb206IGZhbHNlXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgaWYgKHRoaXMudmlld2VyKSB7XG4gICAgICB0aGlzLnZpZXdlci5hZGRIYW5kbGVyKCdjYW52YXMtY2xpY2snLCAoZXZlbnQpID0+IHtcbiAgICAgICAgaWYgKCFldmVudCB8fCAhZXZlbnQucXVpY2sgfHwgIWV2ZW50LnBvc2l0aW9uIHx8ICF0aGlzLnZpZXdlciB8fCAhdGhpcy5uYXZFbmFibGVkKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcG9pbnQgPSB0aGlzLnZpZXdlci52aWV3cG9ydC5wb2ludEZyb21QaXhlbChldmVudC5wb3NpdGlvbik7XG4gICAgICAgIGxldCBmb3VuZEluZGV4ID0gdGhpcy5fZ2V0SGl0RnJhbWUocG9pbnQpO1xuICAgICAgICBpZiAoZm91bmRJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICBjb25zdCByZWFsRnJhbWVJbmRleCA9IHRoaXMuX2ZpZ3VyZUZyYW1lSW5kZXgodHJ1ZSk7XG4gICAgICAgICAgaWYgKHJlYWxGcmFtZUluZGV4ID09PSAtMSAmJiB0aGlzLmZyYW1lSW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5nb1RvRnJhbWUodGhpcy5mcmFtZUluZGV4KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5nb1RvTmV4dEZyYW1lKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGZvdW5kSW5kZXggPT09IHRoaXMuZnJhbWVJbmRleCkge1xuICAgICAgICAgIHRoaXMuZ29Ub05leHRGcmFtZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuZ29Ub0ZyYW1lKGZvdW5kSW5kZXgpO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgb3JpZ2luYWxTY3JvbGxIYW5kbGVyID0gdGhpcy52aWV3ZXIuaW5uZXJUcmFja2VyLnNjcm9sbEhhbmRsZXI7XG4gICAgICB0aGlzLnZpZXdlci5pbm5lclRyYWNrZXIuc2Nyb2xsSGFuZGxlciA9IChldmVudCkgPT4ge1xuICAgICAgICBpZiAoIXRoaXMubmF2RW5hYmxlZCkge1xuICAgICAgICAgIC8vIFJldHVybmluZyBmYWxzZSBzdG9wcyB0aGUgYnJvd3NlciBmcm9tIHNjcm9sbGluZyBpdHNlbGYuXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgIGV2ZW50Lm9yaWdpbmFsRXZlbnQuY3RybEtleSB8fFxuICAgICAgICAgIGV2ZW50Lm9yaWdpbmFsRXZlbnQuYWx0S2V5IHx8XG4gICAgICAgICAgZXZlbnQub3JpZ2luYWxFdmVudC5tZXRhS2V5XG4gICAgICAgICkge1xuICAgICAgICAgIHJldHVybiBvcmlnaW5hbFNjcm9sbEhhbmRsZXIuY2FsbCh0aGlzLnZpZXdlcj8uaW5uZXJUcmFja2VyLCBldmVudCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhldmVudC5zY3JvbGwsIG5vdywgbm93IC0gdGhpcy5sYXN0U2Nyb2xsVGltZSk7XG4gICAgICAgIGlmIChub3cgLSB0aGlzLmxhc3RTY3JvbGxUaW1lIDwgdGhpcy5zY3JvbGxEZWxheSkge1xuICAgICAgICAgIC8vIFJldHVybmluZyBmYWxzZSBzdG9wcyB0aGUgYnJvd3NlciBmcm9tIHNjcm9sbGluZyBpdHNlbGYuXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5sYXN0U2Nyb2xsVGltZSA9IG5vdztcbiAgICAgICAgaWYgKGV2ZW50LnNjcm9sbCA8IDApIHtcbiAgICAgICAgICB0aGlzLmdvVG9OZXh0RnJhbWUoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmdvVG9QcmV2aW91c0ZyYW1lKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXR1cm5pbmcgZmFsc2Ugc3RvcHMgdGhlIGJyb3dzZXIgZnJvbSBzY3JvbGxpbmcgaXRzZWxmLlxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9O1xuXG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChldmVudCkgPT4ge1xuICAgICAgICBpZiAoZXZlbnQuYWx0S2V5IHx8IGV2ZW50LnNoaWZ0S2V5IHx8IGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSB8fCAhdGhpcy5uYXZFbmFibGVkKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGV2ZW50LmtleSA9PT0gJ0Fycm93UmlnaHQnIHx8IGV2ZW50LmtleSA9PT0gJ0Fycm93RG93bicgfHwgZXZlbnQua2V5ID09PSAnICcpIHtcbiAgICAgICAgICB0aGlzLmdvVG9OZXh0RnJhbWUoKTtcbiAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXkgPT09ICdBcnJvd0xlZnQnIHx8IGV2ZW50LmtleSA9PT0gJ0Fycm93VXAnKSB7XG4gICAgICAgICAgdGhpcy5nb1RvUHJldmlvdXNGcmFtZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqIFJlbmRlciB0aGUgY29taWMgb24gc2NyZWVuICovXG4gIG9wZW5Db21pYyh1bnNhZmVDb21pYzogQ29taWMgfCBzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5mcmFtZXMubGVuZ3RoIHx8IHRoaXMuaW1hZ2VJdGVtcy5sZW5ndGgpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgICdDdXJyZW50bHkgdGhlIERyaWZ0b3J5IHZpZXdlciBpcyBub3Qgc2V0IHVwIHRvIGxvYWQgYSBzZWNvbmQgY29taWMgYWZ0ZXIgdGhlIGZpcnN0LidcbiAgICAgICk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB7IGNvbWljIH0gPVxuICAgICAgdHlwZW9mIHVuc2FmZUNvbWljID09PSAnc3RyaW5nJyA/IChKU09OLnBhcnNlKHVuc2FmZUNvbWljKSBhcyBDb21pYykgOiB1bnNhZmVDb21pYztcblxuICAgIG9zZFByb21pc2UudGhlbigoKSA9PiB7XG4gICAgICB0aGlzLmNvbnRhaW5lci5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb21pYy5ib2R5LmJhY2tncm91bmRDb2xvcjtcblxuICAgICAgaWYgKHRoaXMudmlld2VyKSB7XG4gICAgICAgIGlmIChjb21pYy5ib2R5LmZyYW1lcykge1xuICAgICAgICAgIHRoaXMuZnJhbWVzID0gY29taWMuYm9keS5mcmFtZXMubWFwKChmcmFtZSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBPcGVuU2VhZHJhZ29uIS5SZWN0KFxuICAgICAgICAgICAgICBmcmFtZS54IC0gZnJhbWUud2lkdGggLyAyLFxuICAgICAgICAgICAgICBmcmFtZS55IC0gZnJhbWUuaGVpZ2h0IC8gMixcbiAgICAgICAgICAgICAgZnJhbWUud2lkdGgsXG4gICAgICAgICAgICAgIGZyYW1lLmhlaWdodFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmZyYW1lcyA9IGNvbWljLmJvZHkuaXRlbXMubWFwKChpdGVtKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE9wZW5TZWFkcmFnb24hLlJlY3QoXG4gICAgICAgICAgICAgIGl0ZW0ueCAtIGl0ZW0ud2lkdGggLyAyLFxuICAgICAgICAgICAgICBpdGVtLnkgLSBpdGVtLmhlaWdodCAvIDIsXG4gICAgICAgICAgICAgIGl0ZW0ud2lkdGgsXG4gICAgICAgICAgICAgIGl0ZW0uaGVpZ2h0XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29taWMuYm9keS5pdGVtcy5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG4gICAgICAgICAgY29uc3QgaW1hZ2VJdGVtOiBJbWFnZUl0ZW0gPSB7XG4gICAgICAgICAgICBoaWRlVW50aWxGcmFtZTogaXRlbS5oaWRlVW50aWxGcmFtZVxuICAgICAgICAgIH07XG5cbiAgICAgICAgICB0aGlzLmltYWdlSXRlbXMucHVzaChpbWFnZUl0ZW0pO1xuXG4gICAgICAgICAgdGhpcy52aWV3ZXI/LmFkZFRpbGVkSW1hZ2Uoe1xuICAgICAgICAgICAgcHJlbG9hZDogdHJ1ZSxcbiAgICAgICAgICAgIHg6IGl0ZW0ueCAtIGl0ZW0ud2lkdGggLyAyLFxuICAgICAgICAgICAgeTogaXRlbS55IC0gaXRlbS5oZWlnaHQgLyAyLFxuICAgICAgICAgICAgd2lkdGg6IGl0ZW0ud2lkdGgsXG4gICAgICAgICAgICBzdWNjZXNzOiAoZXZlbnQ6IGFueSkgPT4ge1xuICAgICAgICAgICAgICBpbWFnZUl0ZW0udGlsZWRJbWFnZSA9IGV2ZW50Lml0ZW0gYXMgT3BlblNlYWRyYWdvbi5UaWxlZEltYWdlO1xuICAgICAgICAgICAgICB0aGlzLl91cGRhdGVJbWFnZVZpc2liaWxpdHkoKTtcblxuICAgICAgICAgICAgICBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXJ0Q29taWMoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRpbGVTb3VyY2U6IHtcbiAgICAgICAgICAgICAgdHlwZTogJ2xlZ2FjeS1pbWFnZS1weXJhbWlkJyxcbiAgICAgICAgICAgICAgbGV2ZWxzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgdXJsOiBpdGVtLnVybCxcbiAgICAgICAgICAgICAgICAgIHdpZHRoOiBpdGVtLndpZHRoLFxuICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBpdGVtLmhlaWdodFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS1cbiAgX3N0YXJ0Q29taWMoKSB7XG4gICAgaWYgKHRoaXMudmlld2VyKSB7XG4gICAgICBjb25zdCBmcmFtZUhhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGZyYW1lSW5kZXggPSB0aGlzLl9maWd1cmVGcmFtZUluZGV4KGZhbHNlKTtcbiAgICAgICAgaWYgKGZyYW1lSW5kZXggIT09IC0xICYmIGZyYW1lSW5kZXggIT09IHRoaXMuZnJhbWVJbmRleCkge1xuICAgICAgICAgIHRoaXMuZnJhbWVJbmRleCA9IGZyYW1lSW5kZXg7XG4gICAgICAgICAgdGhpcy5fdXBkYXRlSW1hZ2VWaXNpYmlsaXR5KCk7XG5cbiAgICAgICAgICBpZiAodGhpcy5vbkZyYW1lQ2hhbmdlKSB7XG4gICAgICAgICAgICB0aGlzLm9uRnJhbWVDaGFuZ2Uoe1xuICAgICAgICAgICAgICBmcmFtZUluZGV4LFxuICAgICAgICAgICAgICBpc0xhc3RGcmFtZTogZnJhbWVJbmRleCA9PT0gdGhpcy5nZXRGcmFtZUNvdW50KCkgLSAxXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIHRoaXMudmlld2VyLmFkZEhhbmRsZXIoJ3pvb20nLCBmcmFtZUhhbmRsZXIpO1xuICAgICAgdGhpcy52aWV3ZXIuYWRkSGFuZGxlcigncGFuJywgZnJhbWVIYW5kbGVyKTtcbiAgICB9XG5cbiAgICB0aGlzLmdvVG9GcmFtZSgwKTtcblxuICAgIGlmICh0aGlzLm9uQ29taWNMb2FkKSB7XG4gICAgICB0aGlzLm9uQ29taWNMb2FkKHt9KTtcbiAgICB9XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tXG4gIF91cGRhdGVJbWFnZVZpc2liaWxpdHkoKSB7XG4gICAgdGhpcy5pbWFnZUl0ZW1zLmZvckVhY2goKGltYWdlSXRlbSkgPT4ge1xuICAgICAgaWYgKGltYWdlSXRlbS5oaWRlVW50aWxGcmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGltYWdlSXRlbS50aWxlZEltYWdlPy5zZXRPcGFjaXR5KHRoaXMuZnJhbWVJbmRleCA8IGltYWdlSXRlbS5oaWRlVW50aWxGcmFtZSA/IDAgOiAxKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKiBEZXRlcm1pbmUgaWYgdGhlIGZyYW1lIG5hdmlnYXRpb24gY29udHJvbHMgYXJlIGN1cnJlbnRseSBhYmxlIHRvIGJlIHVzZWQgdG8gbmF2aWdhdGUgKi9cbiAgZ2V0TmF2RW5hYmxlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5uYXZFbmFibGVkO1xuICB9XG5cbiAgLyoqIEVuYWJsZSAvIERpc2FibGUgZnJhbWUgbmF2aWdhdGlvbiBjb250cm9scyAqL1xuICBzZXROYXZFbmFibGVkKGZsYWc6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm5hdkVuYWJsZWQgPSBmbGFnO1xuICAgIHRoaXMudmlld2VyPy5zZXRNb3VzZU5hdkVuYWJsZWQoZmxhZyk7XG4gIH1cblxuICAvKiogTmF2aWdhdGUgdG8gYSBzcGVjaWZpYyBmcmFtZSB2aWEgaXRzIGluZGV4IG51bWJlciAqL1xuICBnb1RvRnJhbWUoaW5kZXg6IG51bWJlcikge1xuICAgIGlmICh0aGlzLmdldEZyYW1lSW5kZXgoKSAhPT0gaW5kZXgpIHtcbiAgICAgIHZhciBmcmFtZSA9IHRoaXMuZnJhbWVzW2luZGV4XTtcbiAgICAgIHZhciBidWZmZXJGYWN0b3IgPSAwLjI7XG4gICAgICBpZiAoZnJhbWUpIHtcbiAgICAgICAgdGhpcy5mcmFtZUluZGV4SGludCA9IGluZGV4O1xuXG4gICAgICAgIHZhciBib3ggPSBmcmFtZS5jbG9uZSgpO1xuXG4gICAgICAgIGJveC53aWR0aCAqPSAxICsgYnVmZmVyRmFjdG9yO1xuICAgICAgICBib3guaGVpZ2h0ICo9IDEgKyBidWZmZXJGYWN0b3I7XG4gICAgICAgIGJveC54IC09IGZyYW1lLndpZHRoICogYnVmZmVyRmFjdG9yICogMC41O1xuICAgICAgICBib3gueSAtPSBmcmFtZS5oZWlnaHQgKiBidWZmZXJGYWN0b3IgKiAwLjU7XG5cbiAgICAgICAgdGhpcy52aWV3ZXI/LnZpZXdwb3J0LmZpdEJvdW5kcyhib3gpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKiBHZXQgdGhlIGN1cnJlbnRseSBhY3RpdmUgZnJhbWUgaW5kZXguIFRoaXMgd2lsbCBiZSB3aGF0ZXZlciBmcmFtZSBpcyBpbiB0aGUgbWlkZGxlIG9mIHRoZVxuICBzY3JlZW4uIElmIHRoZXJlIGlzIG5vIGZyYW1lIGluIHRoZSBtaWRkbGUsIGl0J2xsIGJlIHdoYXRldmVyIGZyYW1lIHRoZSB1c2VyIGxhc3QgaGFkIHRoZXJlLiAqL1xuICBnZXRGcmFtZUluZGV4KCkge1xuICAgIHJldHVybiB0aGlzLmZyYW1lSW5kZXg7XG4gIH1cblxuICAvLyAtLS0tLS0tLS0tXG4gIF9maWd1cmVGcmFtZUluZGV4KGN1cnJlbnQ6IGJvb2xlYW4pIHtcbiAgICBsZXQgYmVzdEluZGV4ID0gLTE7XG4gICAgbGV0IGJlc3REaXN0YW5jZSA9IEluZmluaXR5O1xuICAgIGlmICh0aGlzLnZpZXdlcikge1xuICAgICAgY29uc3Qgdmlld3BvcnRCb3VuZHMgPSB0aGlzLnZpZXdlci52aWV3cG9ydC5nZXRCb3VuZHMoY3VycmVudCk7XG4gICAgICBjb25zdCB2aWV3cG9ydENlbnRlciA9IHZpZXdwb3J0Qm91bmRzLmdldENlbnRlcigpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZnJhbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGZyYW1lID0gdGhpcy5mcmFtZXNbaV07XG4gICAgICAgIGlmIChmcmFtZS5jb250YWluc1BvaW50KHZpZXdwb3J0Q2VudGVyKSkge1xuICAgICAgICAgIGlmICh0aGlzLmZyYW1lSW5kZXhIaW50ID09PSBpKSB7XG4gICAgICAgICAgICBiZXN0SW5kZXggPSBpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgZGlzdGFuY2UgPSB2aWV3cG9ydENlbnRlci5zcXVhcmVkRGlzdGFuY2VUbyhmcmFtZS5nZXRDZW50ZXIoKSk7XG4gICAgICAgICAgaWYgKGRpc3RhbmNlIDwgYmVzdERpc3RhbmNlKSB7XG4gICAgICAgICAgICBiZXN0RGlzdGFuY2UgPSBkaXN0YW5jZTtcbiAgICAgICAgICAgIGJlc3RJbmRleCA9IGk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGJlc3RJbmRleDtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS1cbiAgX2dldEhpdEZyYW1lKHBvaW50OiBPcGVuU2VhZHJhZ29uLlBvaW50KSB7XG4gICAgbGV0IGJlc3RJbmRleCA9IC0xO1xuXG4gICAgaWYgKHRoaXMudmlld2VyKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZnJhbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGZyYW1lID0gdGhpcy5mcmFtZXNbaV07XG4gICAgICAgIGlmIChmcmFtZS5jb250YWluc1BvaW50KHBvaW50KSkge1xuICAgICAgICAgIGlmICh0aGlzLmZyYW1lSW5kZXggPT09IGkpIHtcbiAgICAgICAgICAgIGJlc3RJbmRleCA9IGk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoYmVzdEluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgYmVzdEluZGV4ID0gaTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYmVzdEluZGV4O1xuICB9XG5cbiAgLyoqIFJldHVybiB0aGUgdG90YWwgbnVtYmVyIG9mIGZyYW1lcyBmb3VuZCBpbiB0aGUgY29taWMgc2VxdWVuY2UgKi9cbiAgZ2V0RnJhbWVDb3VudCgpIHtcbiAgICByZXR1cm4gdGhpcy5mcmFtZXMubGVuZ3RoO1xuICB9XG5cbiAgLyoqIE5hdmlnYXRlIHRvIHRoZSBuZXh0IGZyYW1lIGluIHRoZSBzZXF1ZW5jZSAqL1xuICBnb1RvTmV4dEZyYW1lKCkge1xuICAgIGxldCBpbmRleCA9IHRoaXMuZ2V0RnJhbWVJbmRleCgpO1xuICAgIGlmIChpbmRleCA8IHRoaXMuZnJhbWVzLmxlbmd0aCAtIDEpIHtcbiAgICAgIHRoaXMuZ29Ub0ZyYW1lKGluZGV4ICsgMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub25Ob05leHQoe30pO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBOYXZpZ2F0ZSB0byB0aGUgcHJldmlvdXMgZnJhbWUgaW4gdGhlIHNlcXVlbmNlICovXG4gIGdvVG9QcmV2aW91c0ZyYW1lKCkge1xuICAgIGxldCBpbmRleCA9IHRoaXMuZ2V0RnJhbWVJbmRleCgpO1xuICAgIGlmIChpbmRleCA+IDApIHtcbiAgICAgIHRoaXMuZ29Ub0ZyYW1lKGluZGV4IC0gMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub25Ob1ByZXZpb3VzKHt9KTtcbiAgICB9XG4gIH1cbn1cbiJdfQ=="}